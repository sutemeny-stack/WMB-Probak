<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pr√≥b√°k ‚Äì 2026</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    .day-box {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 10px;
      border-bottom: 1px solid #e5e7eb;
      height: 1.75rem;
      user-select: none;
      transition: background-color 0.2s;
      white-space: nowrap;
    }

    .marked { background-color: #4ade80; }

    .section-Sebi  { background-color: #fde68a; }
    .section-Mil√°n { background-color: #bfdbfe; }
    .section-F√≥ri  { background-color: #d9f99d; }
    .section-S√ºti  { background-color: #fbcfe8; }

    .day-wrapper {
      min-width: 120px;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      background: white;
      display: flex;
      flex-direction: column;
      font-size: 10px;
    }

    /* üî• Aktu√°lis nap */
    .current-day {
      outline: 3px solid #ef4444;
      outline-offset: -3px;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Pr√≥b√°k ‚Äì 2026</h1>

    <!-- H√≥napv√°laszt√≥ -->
    <div class="mb-4 flex items-center gap-3">
      <label for="monthSelect" class="font-medium">H√≥nap:</label>
      <select id="monthSelect" class="border rounded px-2 py-1">
        <option value="1">Janu√°r</option>
        <option value="2">Febru√°r</option>
        <option value="3">M√°rcius</option>
        <option value="4">√Åprilis</option>
        <option value="5">M√°jus</option>
        <option value="6">J√∫nius</option>
        <option value="7">J√∫lius</option>
        <option value="8">Augusztus</option>
        <option value="9">Szeptember</option>
        <option value="10">Okt√≥ber</option>
        <option value="11">November</option>
        <option value="12">December</option>
      </select>
    </div>

    <div class="overflow-x-auto">
      <div id="calendar" class="grid grid-cols-5 gap-4 min-w-[900px]"></div>
    </div>

    <button id="saveBtn"
      class="px-4 py-2 mt-4 bg-indigo-500 text-white rounded hover:bg-indigo-600">
      Ment√©s
    </button>
  </div>

  <script>
    // üîπ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyB0KlQPh9VO54JBCL-kkNsAgdw4W5IYwXY",
      authDomain: "wmb-probak.firebaseapp.com",
      projectId: "wmb-probak",
      storageBucket: "wmb-probak.firebasestorage.app",
      messagingSenderId: "187067263796",
      appId: "1:187067263796:web:b04190c2a8152207dc1361"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // üîπ Alapadatok
    const year = 2026;
    let currentMonth = 7;

    const hours = Array.from({ length: 8 }, (_, i) => 14 + i);
    const sections = ["Sebi", "Mil√°n", "F√≥ri", "S√ºti"];
    const sectionColors = {
      "Sebi": "section-Sebi",
      "Mil√°n": "section-Mil√°n",
      "F√≥ri": "section-F√≥ri",
      "S√ºti": "section-S√ºti"
    };

    const weekdays = ["H√©tf≈ë","Kedd","Szerda","Cs√ºt√∂rt√∂k","P√©ntek","Szombat","Vas√°rnap"];
    const monthNames = [
      "Janu√°r","Febru√°r","M√°rcius","√Åprilis","M√°jus","J√∫nius",
      "J√∫lius","Augusztus","Szeptember","Okt√≥ber","November","December"
    ];

    const selected = {};

    function daysInMonth(year, month) {
      return new Date(year, month, 0).getDate();
    }

    function weekdayLabel(year, month, day) {
      const js = new Date(year, month - 1, day);
      return weekdays[(js.getDay() + 6) % 7];
    }

    function isWeekend(year, month, day) {
      const d = new Date(year, month - 1, day).getDay();
      return d === 0 || d === 6;
    }

    function isToday(year, month, day) {
      const now = new Date();
      return (
        now.getFullYear() === year &&
        now.getMonth() + 1 === month &&
        now.getDate() === day
      );
    }

    function toggle(key) {
      selected[key] = !selected[key];
      render();
    }

    function render() {
      const container = document.getElementById("calendar");
      container.innerHTML = "";

      const days = daysInMonth(year, currentMonth);

      const firstDay = new Date(year, currentMonth - 1, 1);
      const firstWeekday = (firstDay.getDay() + 6) % 7;
      const leadingEmpty = Math.min(firstWeekday, 5);

      for (let i = 0; i < leadingEmpty; i++) {
        container.appendChild(document.createElement("div"));
      }

      for (let day = 1; day <= days; day++) {
        if (isWeekend(year, currentMonth, day)) continue;

        const dayWrapper = document.createElement("div");
        dayWrapper.className = "day-wrapper";

        if (isToday(year, currentMonth, day)) {
          dayWrapper.classList.add("current-day");
        }

        const header = document.createElement("div");
        header.className = "px-1 py-1 font-semibold text-center border-b";
        header.innerHTML = `
          ${monthNames[currentMonth - 1]} ${day}<br>
          <span class="font-normal">${weekdayLabel(year, currentMonth, day)}</span>
        `;
        dayWrapper.appendChild(header);

        const grid = document.createElement("div");
        grid.className = "grid grid-cols-4";

        sections.forEach(section => {
          const col = document.createElement("div");

          hours.forEach(hour => {
            const key = `${year}-${String(currentMonth).padStart(2,"0")}-${String(day).padStart(2,"0")}-${hour}-${section}`;
            const box = document.createElement("div");
            box.className = `day-box ${selected[key] ? "marked" : "bg-white hover:bg-indigo-50"}`;
            box.textContent = `${hour}:00`;
            box.onclick = () => toggle(key);
            col.appendChild(box);
          });

          const label = document.createElement("div");
          label.className = `text-center text-[10px] font-medium border-t ${sectionColors[section]}`;
          label.textContent = section;
          col.appendChild(label);

          grid.appendChild(col);
        });

        dayWrapper.appendChild(grid);
        container.appendChild(dayWrapper);
      }
    }

    // üîπ Firestore bet√∂lt√©s
    db.collection("votes").get().then(snapshot => {
      snapshot.forEach(doc => {
        selected[doc.id] = doc.data().marked;
      });
      render();
    });

    // üîπ Ment√©s (h√≥nap n√©zettel egy√ºtt)
    document.getElementById("saveBtn").onclick = () => {
      for (const key in selected) {
        const [y, m, d, hour, section] = key.split("-");

        db.collection("votes").doc(key).set({
          year: Number(y),
          month: Number(m),
          day: Number(d),
          hour: Number(hour),
          section: section,
          marked: selected[key],
          monthView: `${y}-${m}`
        });
      }
      alert("Ment√©s k√©sz!");
    };

    // üîπ H√≥napv√°lt√°s
    document.getElementById("monthSelect").value = currentMonth;
    document.getElementById("monthSelect").onchange = e => {
      currentMonth = parseInt(e.target.value);
      render();
    };

    window.onload = render;
  </script>
</body>
</html>
