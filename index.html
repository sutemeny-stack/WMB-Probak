<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Janu√°r Pr√≥b√°k</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    .day-box {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 10px;
      border-bottom: 1px solid #e5e7eb;
      height: 1.75rem;
      user-select: none;
      white-space: nowrap;
      transition: background-color 0.2s;
    }

    .marked { background-color: #4ade80; }

    .section-Sebi  { background-color: #fde68a; }
    .section-Mil√°n { background-color: #bfdbfe; }
    .section-F√≥ri  { background-color: #d9f99d; }
    .section-S√ºti  { background-color: #fbcfe8; }

    .day-wrapper {
      min-width: 140px;      /* üî• iOS miatt */
      flex-shrink: 0;        /* üî• EZ TESZI SCROLL-OZHAT√ìV√Å */
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      background: white;
      display: flex;
      flex-direction: column;
      font-size: 10px;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Janu√°r Pr√≥b√°k</h1>

    <!-- üîπ iOS-biztos v√≠zszintes scroll -->
    <div class="overflow-x-auto">
      <div id="calendar" class="flex gap-4 w-max"></div>
    </div>

    <button id="saveBtn"
      class="px-4 py-2 mt-4 bg-indigo-500 text-white rounded hover:bg-indigo-600">
      Ment√©s
    </button>

    <p class="text-xs text-gray-500 mt-3">
      Kattint√°ssal jel√∂lhetsz id≈ëpontokat. A Ment√©s gomb elmenti az √°llapotot.
    </p>
  </div>

  <script>
    // üîπ Firebase konfigur√°ci√≥
    const firebaseConfig = {
      apiKey: "AIzaSyB0KlQPh9VO54JBCL-kkNsAgdw4W5IYwXY",
      authDomain: "wmb-probak.firebaseapp.com",
      projectId: "wmb-probak",
      storageBucket: "wmb-probak.firebasestorage.app",
      messagingSenderId: "187067263796",
      appId: "1:187067263796:web:b04190c2a8152207dc1361",
      measurementId: "G-526WQ7153L"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // üîπ Alapadatok
    const days = Array.from({ length: 31 }, (_, i) => i + 1);
    const hours = Array.from({ length: 8 }, (_, i) => 14 + i);
    const sections = ["Sebi", "Mil√°n", "F√≥ri", "S√ºti"];
    const sectionColors = {
      "Sebi": "section-Sebi",
      "Mil√°n": "section-Mil√°n",
      "F√≥ri": "section-F√≥ri",
      "S√ºti": "section-S√ºti"
    };
    const weekdays = ["H√©tf≈ë","Kedd","Szerda","Cs√ºt√∂rt√∂k","P√©ntek","Szombat","Vas√°rnap"];
    const selected = {};

    function weekdayLabel(year, month, day) {
      const js = new Date(year, month - 1, day);
      return weekdays[(js.getDay() + 6) % 7];
    }

    function toggle(key) {
      selected[key] = !selected[key];
      render();
    }

    function render() {
      const container = document.getElementById("calendar");
      container.innerHTML = "";

      const jan1 = new Date(2026, 0, 1);
      const leadingEmpty = (jan1.getDay() + 6) % 7;

      for (let i = 0; i < leadingEmpty; i++) {
        container.appendChild(document.createElement("div"));
      }

      days.forEach(day => {
        const dayWrapper = document.createElement("div");
        dayWrapper.className = "day-wrapper";

        const header = document.createElement("div");
        header.className = "px-1 py-1 font-semibold text-center border-b";
        header.innerHTML = `Jan ${day}<br><span class="font-normal">${weekdayLabel(2026,1,day)}</span>`;
        dayWrapper.appendChild(header);

        const grid = document.createElement("div");
        grid.className = "grid grid-cols-4";

        sections.forEach(section => {
          const col = document.createElement("div");

          hours.forEach(hour => {
            const key = `2026-01-${String(day).padStart(2,"0")}-${hour}-${section}`;
            const box = document.createElement("div");
            box.className = `day-box ${selected[key] ? "marked" : "bg-white hover:bg-indigo-50"}`;
            box.textContent = `${hour}:00`;
            box.onclick = () => toggle(key);
            col.appendChild(box);
          });

          const label = document.createElement("div");
          label.className = `text-center text-[10px] font-medium border-t ${sectionColors[section]}`;
          label.textContent = section;
          col.appendChild(label);

          grid.appendChild(col);
        });

        dayWrapper.appendChild(grid);
        container.appendChild(dayWrapper);
      });
    }

    // üîπ Bet√∂lt√©s Firestore-b√≥l
    db.collection("votes").get().then(snapshot => {
      snapshot.forEach(doc => {
        selected[doc.id] = doc.data().marked;
      });
      render();
    });

    // üîπ Ment√©s
    document.getElementById("saveBtn").onclick = () => {
      for (const key in selected) {
        db.collection("votes").doc(key).set({ marked: selected[key] });
      }
      alert("Ment√©s k√©sz!");
    };

    window.onload = render;
  </script>
</body>
</html>
