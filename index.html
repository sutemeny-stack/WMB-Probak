<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Próbák – 2026</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    .day-box {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 10px;
      border-bottom: 1px solid #e5e7eb;
      height: 1.75rem;
      user-select: none;
    }

    .marked { background-color: #4ade80; }

    .section-Sebi  { background-color: #fde68a; }
    .section-Milan { background-color: #bfdbfe; }
    .section-Flori  { background-color: #d9f99d; }
    .section-Suti  { background-color: #fbcfe8; }

    .day-wrapper {
      min-width: 120px;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      background: white;
      display: flex;
      flex-direction: column;
      font-size: 10px;
    }

    .current-day {
      outline: 3px solid #ef4444;
      outline-offset: -3px;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen p-4">
<div class="max-w-7xl mx-auto">

  <h1 class="text-2xl font-bold mb-4">Próbák – 2026</h1>

  <!-- Hónapválasztó -->
  <div class="mb-4 flex items-center gap-3">
    <label class="font-medium">Hónap:</label>
    <select id="monthSelect" class="border rounded px-2 py-1">
      <option value="1">Január</option>
      <option value="2">Február</option>
      <option value="3">Március</option>
      <option value="4">Április</option>
      <option value="5">Május</option>
      <option value="6">Június</option>
      <option value="7">Július</option>
      <option value="8">Augusztus</option>
      <option value="9">Szeptember</option>
      <option value="10">Október</option>
      <option value="11">November</option>
      <option value="12">December</option>
    </select>
  </div>

  <div class="overflow-x-auto">
    <!-- 5 oszlop = H–P -->
    <div id="calendar" class="grid grid-cols-5 gap-4 min-w-[900px]"></div>
  </div>

  <button id="saveBtn"
    class="px-4 py-2 mt-4 bg-indigo-500 text-white rounded hover:bg-indigo-600">
    Mentés
  </button>

</div>

<script>
/* ================= Firebase ================= */

firebase.initializeApp({
  apiKey: "AIzaSyB0KlQPh9VO54JBCL-kkNsAgdw4W5IYwXY",
  authDomain: "wmb-probak.firebaseapp.com",
  projectId: "wmb-probak"
});

const db = firebase.firestore();

/* ================= Alapadatok ================= */

const year = 2026;
let currentMonth = 7; // fallback

const hours = Array.from({ length: 8 }, (_, i) => 14 + i);
const sections = ["Sebi", "Milan", "Flori", "Suti"];
const sectionColors = {
  Sebi: "section-Sebi",
  Milan: "section-Milan",
  Flori: "section-Flori",
  Suti: "section-Suti"
};

const weekdays = ["Hétfő","Kedd","Szerda","Csütörtök","Péntek","Szombat","Vasárnap"];
const monthNames = [
  "Január","Február","Március","Április","Május","Június",
  "Július","Augusztus","Szeptember","Október","November","December"
];

const selected = {};

/* ================= Segédek ================= */

const daysInMonth = (y,m) => new Date(y,m,0).getDate();
const isWeekend = (y,m,d) => [0,6].includes(new Date(y,m-1,d).getDay());
const isToday = (y,m,d) => {
  const n = new Date();
  return n.getFullYear()===y && n.getMonth()+1===m && n.getDate()===d;
};

/* ================= Render ================= */

function render() {
  const container = document.getElementById("calendar");
  container.innerHTML = "";

  // ---- Hétfőre igazítás (EZ A LÉNYEG) ----
  const firstDay = new Date(year, currentMonth - 1, 1);
  const firstWeekday = (firstDay.getDay() + 6) % 7; // hétfő=0

  // üres helyek hétfőig (csak munkanapok!)
  for (let i = 0; i < firstWeekday; i++) {
    if (i < 5) {
      container.appendChild(document.createElement("div"));
    }
  }

  // ---- Napok ----
  for (let day = 1; day <= daysInMonth(year, currentMonth); day++) {
    if (isWeekend(year, currentMonth, day)) continue;

    const wrap = document.createElement("div");
    wrap.className = "day-wrapper";
    if (isToday(year, currentMonth, day)) {
      wrap.classList.add("current-day");
    }

    const header = document.createElement("div");
    header.className = "text-center border-b font-semibold p-1";
    header.innerHTML = `
      ${monthNames[currentMonth-1]} ${day}<br>
      <span class="font-normal">
        ${weekdays[(new Date(year,currentMonth-1,day).getDay()+6)%7]}
      </span>
    `;
    wrap.appendChild(header);

    const grid = document.createElement("div");
    grid.className = "grid grid-cols-4";

    sections.forEach(section => {
      const col = document.createElement("div");

      hours.forEach(hour => {
        const key =
          `${year}-${String(currentMonth).padStart(2,"0")}-${String(day).padStart(2,"0")}-${hour}-${section}`;

        const box = document.createElement("div");
        box.className = "day-box " + (selected[key] ? "marked" : "");
        box.textContent = `${hour}:00`;
        box.onclick = () => {
          selected[key] = !selected[key];
          render();
        };
        col.appendChild(box);
      });

      const label = document.createElement("div");
      label.className = `text-center border-t ${sectionColors[section]}`;
      label.textContent = section;
      col.appendChild(label);

      grid.appendChild(col);
    });

    wrap.appendChild(grid);
    container.appendChild(wrap);
  }
}

/* ================= Init ================= */

async function init() {
  // UI állapot
  const uiDoc = await db.collection("meta").doc("ui").get();
  if (uiDoc.exists) {
    currentMonth = uiDoc.data().currentMonth;
  }
  document.getElementById("monthSelect").value = currentMonth;

  // Szavazatok
  const snap = await db.collection("votes").get();
  snap.forEach(d => selected[d.id] = d.data().marked);

  render();
}

init();

/* ================= Mentés ================= */

document.getElementById("saveBtn").onclick = async () => {

  try {
    // Meta mentése
    await db.collection("meta").doc("ui").set({ currentMonth });

    // Votes mentése párhuzamosan
    const writes = [];
    for (const key in selected) {
      writes.push(
        db.collection("votes").doc(key).set({
          marked: selected[key],
          secret: "hobbi123"
        })
      );
    }
    await Promise.all(writes);

    alert("Mentés kész!");
  } catch (e) {
    console.error("Mentés hiba:", e);
    alert("Hiba történt a mentés során!");
  }
};

/* ================= Hónapváltás ================= */

document.getElementById("monthSelect").onchange = e => {
  currentMonth = Number(e.target.value);
  render();
};
</script>
</body>
</html>






